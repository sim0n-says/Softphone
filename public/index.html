<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://sdk.twilio.com https://*.twilio.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; connect-src *;">
    <title>Sim0n-Says Comm</title>
    <link rel="icon" href="data:,">
    <!-- <link rel="stylesheet" href="cyberpunk.css"> -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://sdk.twilio.com/js/client/releases/1.13.1/twilio.js"></script>
</head>
<body class="phreaking-terminal">
    <div class="switch-grid">
        <!-- Interface principale avec disposition cyberpunk -->
        <div class="phreaking-container">
            
            <!-- Header flottant avec effet holographique -->
            <header class="quantum-header">
                <div class="data-stream">
                    <div class="terminal-line">
                        <span class="prompt">SWITCH_NODE@</span>
                        <span class="domain">TELECOM.SYS</span>
                        <span class="cursor">_</span>
                    </div>
                    <h1 class="system-title cyber-glitch-2" data-text="SIM0N-SAYS DIAL">
                        <i class="fas fa-phone neural-icon"></i>
                        <span class="title-fragment">SIM0N-SAYS</span>
                        <span class="title-fragment">DIAL</span>
                    </h1>
                </div>
                <div class="system-status">
                    <div class="status-matrix">
                        <span id="connection-status" class="matrix-node offline">OFFLINE</span>
                        <span id="config-status" class="config-matrix" style="display: none;">
                            <i class="fas fa-satellite-dish"></i> EXCHANGE_SYNC
                        </span>
                    </div>
                    <!-- Bouton config repositionné à droite -->
                    <button id="settings-btn" class="header-config-btn" title="Configuration">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </header>

            <!-- Zone principale avec layout triangulaire -->
            <main class="phreaking-interface">
                
                <!-- Terminal de communication central -->
                <section class="dial-terminal">
                    <div class="terminal-frame">
                        <div class="frame-header">
                            <div class="terminal-dots">
                                <span class="dot red"></span>
                                <span class="dot amber"></span>
                                <span class="dot green"></span>
                            </div>
                            <span class="terminal-title">/DIAL/EXCHANGE.interface</span>
                        </div>
                        
                        <div class="terminal-body">
                            <!-- Display holographique -->
                            <div class="holo-display">
                                <div class="scan-lines"></div>
                                <div class="display-content">
                                    <div class="number-input-zone">
                                        <input type="text" id="phone-number" placeholder="[TARGET_LINE]" maxlength="20" class="phreaking-input">
                                        <div class="input-effects">
                                            <div class="input-glow"></div>
                                            <div class="typing-cursor"></div>
                                        </div>
                                    </div>
                                    <div class="call-status-hud" id="call-info" style="display: none;">
                                        <div class="hud-line">
                                            <span class="status-label">LINE_STATUS:</span>
                                            <span id="call-status" class="status-value">CONNECTING...</span>
                                        </div>
                                        <div class="hud-line">
                                            <span class="status-label">DURATION:</span>
                                            <span id="call-duration" class="timer-display cyber-glitch-3">00:00</span>
                    </div>
                    </div>
                    </div>
                </div>

                            <!-- Matrice de contrôle du pavé numérique -->
                            <div class="control-matrix">
                                <div class="dial-grid">
                                    <div class="dial-row">
                                        <button class="dial-key cyber-button-small" data-number="1">
                                            <span class="dial-number">1</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="2">
                                            <span class="dial-number">2</span>
                                            <span class="dial-letters">ABC</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="3">
                                            <span class="dial-number">3</span>
                                            <span class="dial-letters">DEF</span>
                                        </button>
                                    </div>
                                    <div class="dial-row">
                                        <button class="dial-key cyber-button-small" data-number="4">
                                            <span class="dial-number">4</span>
                                            <span class="dial-letters">GHI</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="5">
                                            <span class="dial-number">5</span>
                                            <span class="dial-letters">JKL</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="6">
                                            <span class="dial-number">6</span>
                                            <span class="dial-letters">MNO</span>
                                        </button>
                                    </div>
                                    <div class="dial-row">
                                        <button class="dial-key cyber-button-small" data-number="7">
                                            <span class="dial-number">7</span>
                                            <span class="dial-letters">PQRS</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="8">
                                            <span class="dial-number">8</span>
                                            <span class="dial-letters">TUV</span>
                                        </button>
                                        <button class="dial-key cyber-button-small" data-number="9">
                                            <span class="dial-number">9</span>
                                            <span class="dial-letters">WXYZ</span>
                                        </button>
                                    </div>
                                    <div class="dial-row dial-bottom">
                                        <button class="dial-key cyber-button-small" data-number="*">
                                            <span class="dial-number">*</span>
                                            <span class="dial-letters">STAR</span>
                    </button>
                                        <button class="dial-key cyber-button-small" data-number="0">
                                            <span class="dial-number">0</span>
                                            <span class="dial-letters">OPER</span>
                    </button>
                                        <button class="dial-key cyber-button-small" data-number="#">
                                            <span class="dial-number">#</span>
                                            <span class="dial-letters">POUND</span>
                    </button>
                                    </div>
                                </div>
                </div>

                            <!-- Panneau de contrôle principal -->
                            <div class="command-panel">
                                <button id="call-btn" class="phreaking-command primary">
                                    <div class="command-icon">
                                        <i class="fas fa-phone"></i>
                                    </div>
                                    <span class="command-label">CONNECT</span>
                        </button>
                                <button id="clear-btn" class="phreaking-command secondary">
                                    <div class="command-icon">
                                        <i class="fas fa-backspace"></i>
                                    </div>
                                    <span class="command-label">CLEAR</span>
                        </button>
                                <button id="hangup-btn" class="phreaking-command danger" style="display: none;">
                                    <div class="command-icon">
                                        <i class="fas fa-phone-slash"></i>
                                    </div>
                                    <span class="command-label">HANGUP</span>
                        </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Panneau latéral gauche - Contrôles audio -->
                <aside class="phreaking-sidebar left">
                    <div class="sidebar-panel" id="audio-controls" style="display: none;">
                        <div class="panel-header">
                            <h3 class="panel-title">AUDIO_SWITCH</h3>
                            <div class="panel-indicator"></div>
                        </div>
                        <div class="audio-matrix">
                            <div class="matrix-row">
                                <button id="mute-btn" class="matrix-node" title="Mute Line">
                                    <i class="fas fa-microphone"></i>
                                    <span class="node-label">MIC</span>
                                </button>
                                <button id="hold-btn" class="matrix-node" title="Hold Line">
                                    <i class="fas fa-pause"></i>
                                    <span class="node-label">HOLD</span>
                                </button>
                            </div>
                            <div class="matrix-row">
                                <button id="speaker-btn" class="matrix-node" title="Speaker">
                            <i class="fas fa-volume-up"></i>
                                    <span class="node-label">SPK</span>
                        </button>
                                <button id="record-btn" class="matrix-node cyber-glitch-4" title="Tap Line">
                            <i class="fas fa-circle"></i>
                                    <span class="node-label">TAP</span>
                        </button>
                            </div>
                        </div>
                    </div>

                    <!-- Sélecteurs audio intégrés -->
                    <div class="sidebar-panel" id="audio-settings">
                        <div class="panel-header">
                            <h3 class="panel-title">LINE_DEVICES</h3>
                        </div>
                        <div class="device-selectors">
                            <div class="selector-group">
                                <label class="device-label">INPUT_LINE</label>
                                <div class="cyber-select-full">
                                    <select id="input-device">
                                        <option value="">Scanning...</option>
                                    </select>
                    </div>
                </div>
                            <div class="selector-group">
                                <label class="device-label">OUTPUT_LINE</label>
                                <div class="cyber-select-full">
                                    <select id="output-device">
                                        <option value="">Scanning...</option>
                        </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Panneau latéral droit - Historique -->
                <aside class="phreaking-sidebar right">
                    <div class="sidebar-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">CALL_LOG</h3>
                            <div class="panel-indicator"></div>
                        </div>
                        <div class="data-stream-container">
                            <div class="stream-header">
                                <i class="fas fa-database"></i>
                                <span>EXCHANGE.db</span>
                                <div class="stream-controls">
                                    <button onclick="forceLoadLogs()" class="stream-btn cyber-btn" title="Force Load" data-type="success">
                                        <i class="fas fa-download"></i>
                                        <span class="btn-text">LOAD</span>
                                    </button>
                                    <button onclick="testAPIDirect()" class="stream-btn cyber-btn" title="Test API Direct" data-type="warning">
                                        <i class="fas fa-code"></i>
                                        <span class="btn-text">TEST</span>
                                    </button>
                                    <button id="test-log-btn" class="stream-btn cyber-btn" title="Test Log" data-type="error">
                                        <i class="fas fa-bug"></i>
                                        <span class="btn-text">DEBUG</span>
                                    </button>
                                    <button id="refresh-logs" class="stream-btn cyber-btn" title="Actualiser" data-type="info">
                                        <i class="fas fa-sync-alt"></i>
                                        <span class="btn-text">SYNC</span>
                                    </button>
                                    <button id="clear-logs" class="stream-btn cyber-btn" title="Effacer" data-type="danger">
                                        <i class="fas fa-trash"></i>
                                        <span class="btn-text">CLEAR</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Statistiques des appels -->
                            <div class="call-stats" id="call-stats">
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <span class="stat-label">TOTAL</span>
                                        <span class="stat-value" id="total-calls">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">ENTRANTS</span>
                                        <span class="stat-value" id="inbound-calls">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">SORTANTS</span>
                                        <span class="stat-value" id="outbound-calls">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">DURÉE MOY</span>
                                        <span class="stat-value" id="avg-duration">0s</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Logs des appels -->
                            <div class="call-logs" id="call-logs">
                                <div class="logs-header">
                                    <span class="logs-title">CALL_LOG</span>
                                    <span class="logs-count" id="logs-count">0 entrées</span>
                                </div>
                                <div class="logs-container" id="logs-container">
                                    <div class="no-data-message">
                                        <div class="loading-dots">
                                            <span></span><span></span><span></span>
                                        </div>
                                        <p>NO_CALLS_LOGGED</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>
            </main>
        </div>

        <!-- Système de notifications -->
        <div id="phreaking-notifications" class="phreaking-notifications">
            <!-- Les notifications seront ajoutées dynamiquement ici -->
        </div>

        <!-- Éléments flottants -->
        <div class="floating-controls">
            <button id="mic-access-btn" class="quantum-button alert" style="display: none;">
                <i class="fas fa-microphone-slash"></i>
                <span class="quantum-label">ENABLE_MIC</span>
            </button>
                </div>

        <!-- Modal de configuration redesigné -->
        <div id="settings-modal" class="phreaking-modal">
            <div class="modal-terminal">
                <div class="terminal-header">
                    <span class="close phreaking-close">&times;</span>
                    <div class="header-text">
                        <span class="terminal-prompt">root@exchange:~/config#</span>
                    </div>
                </div>
                <div class="terminal-content">
                    <div class="config-banner">
                        <span class="config-icon">📞</span>
                        <span class="config-text">SWITCH_CONFIGURATION</span>
                    </div>
                    <form id="settings-form" class="config-form">
                        <div class="config-group">
                            <label class="config-label">CALLER_ID:</label>
                            <div class="cyber-input-full">
                                <input type="text" id="identity" placeholder="Enter caller identity" required>
                            </div>
                        </div>
                        <div class="config-group">
                            <label class="config-label">SOURCE_LINE:</label>
                            <div class="cyber-input-full">
                        <input type="text" id="from-number" placeholder="+1234567890" required>
                    </div>
                        </div>
                        <button type="submit" class="config-submit cyber-button">
                            <span class="submit-text">APPLY_CONFIG</span>
                        </button>
                </form>
                </div>
            </div>
        </div>

        <!-- Modal d'appel entrant redesigné -->
        <div id="incoming-call-modal" class="phreaking-modal priority">
            <div class="alert-terminal">
                <div class="alert-header">
                    <div class="alert-status">
                        <i class="fas fa-phone-volume cyber-glitch-1"></i>
                        <span class="alert-text">INCOMING_CALL</span>
                    </div>
                </div>
                <div class="alert-content">
                    <div class="transmission-info">
                        <div class="source-id" id="caller-number">[UNKNOWN_CALLER]</div>
                        <div class="transmission-type" id="caller-info">Line ringing...</div>
                </div>
                    <div class="response-matrix">
                        <button class="response-node accept" id="btn-accept-call">
                        <i class="fas fa-phone"></i>
                            <span class="response-label">ANSWER</span>
                    </button>
                        <button class="response-node reject" id="btn-reject-call">
                        <i class="fas fa-phone-slash"></i>
                            <span class="response-label">REJECT</span>
                    </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js?v=1.1"></script>
</body>
</html> 